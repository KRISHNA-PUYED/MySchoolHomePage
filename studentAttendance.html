<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="apple-mobile-web-app-capable" content="yes">

  <title>Class-wise Attendance System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>


  body, html {
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
    }

    .container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
.present {
  background-color: #d4edda;
}

.absent {
  background-color: #f8d7da;
}


</style>



</head>
<body class="p-2 bg-light" style="min-height: 100vh;">

  <div class="container">
    <h1 class="text-center mb-4">जि.प.प्रा.शाळा सिंधि</h1>

    <!-- Add Student -->
    <div class="card mb-4">
      <div class="card-header">Add Student</div>
      <div class="card-body">
        <div class="row g-2">
          <div class="col-md-4">
            <select class="form-select" id="addClass">
              <option value="">Select Class</option>
              <option value="Class 1">वर्ग १ ला</option>
              <option value="Class 2">वर्ग 2 रा</option>
              <option value="Class 3">वर्ग ३ रा</option>
              <option value="Class 4">वर्ग ४ था</option>
              <option value="Class 5">वर्ग ५ वा</option>
              <option value="Class 6">वर्ग ६ वा</option>
              <option value="Class 7">वर्ग ७ वा</option>
              <option value="Class 8">वर्ग ८ वा</option>
            </select>
          </div>
          <div class="col-md-4">
            <input type="text" id="studentName" class="form-control" placeholder="Student Name">
          </div>
          <div class="col-md-4">
            <button class="btn btn-primary w-100" onclick="addStudent()">Add Student</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Show Students -->
    <div class="card mb-4">
      <div class="card-header">View & Mark Attendance</div>

<div class="card-body">
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="attendanceDate" class="form-label">Select Date:</label>
      <input type="date" class="form-control" id="attendanceDate" onchange="showStudents()">
    </div>
    <div class="col-md-6">
      <label for="viewClass" class="form-label">Select Class to View:</label>
      <select class="form-select" id="viewClass" onchange="showStudents()">
        <option value="">Select Class</option>
          <option value="Class 1">वर्ग १ ला</option>
              <option value="Class 2">वर्ग 2 रा</option>
              <option value="Class 3">वर्ग ३ रा</option>
              <option value="Class 4">वर्ग ४ था</option>
              <option value="Class 5">वर्ग ५ वा</option>
              <option value="Class 6">वर्ग ६ वा</option>
              <option value="Class 7">वर्ग ७ वा</option>
              <option value="Class 8">वर्ग ८ वा</option>
      </select>
    </div>
  </div>

       <div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Status</th>
        <th>Mark Present</th>
        <th>Profile</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="studentList"></tbody>
  </table>
</div>

      </div>
    </div>

    <!-- Download -->
    <div class="text-center">
    <button class="btn btn-danger mt-2" onclick="downloadPDF()">Download Attendance (PDF)</button>

    </div>
  </div>
<script>
let storageKey = "attendanceSystem";

function loadData() {
  return JSON.parse(localStorage.getItem(storageKey)) || {};
}

function saveData(data) {
  localStorage.setItem(storageKey, JSON.stringify(data));
}

function getSelectedDate() {
  return document.getElementById("attendanceDate").value || new Date().toISOString().split("T")[0];
}


function addStudent() {
  const className = document.getElementById("addClass").value;
  const studentName = document.getElementById("studentName").value.trim();
  if (!className || !studentName) return alert("Please select class and enter student name.");

  const data = loadData();
  data[className] = data[className] || [];

  const existing = data[className].find(s => s.name === studentName);
  if (existing) return alert("Student already exists.");

  data[className].push({ name: studentName, attendance: {} });
  saveData(data);
  alert("Student added.");
  document.getElementById("studentName").value = "";
}

function showStudents() {
const today = getSelectedDate();
  const className = document.getElementById("viewClass").value;
  const data = loadData();
  const students = data[className] || [];

  const list = document.getElementById("studentList");
  list.innerHTML = "";

  students.forEach((student, i) => {
    const status = student.attendance[today];
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${student.name}</td>
      <td class="${status === 'Present' ? 'present' : (status === 'Absent' ? 'absent' : '')}">
        ${status || "Not Marked"}
      </td>
   <td>
  <button class="btn btn-sm btn-success me-1" onclick="markPresent('${className}', ${i})" ${status ? 'disabled' : ''}>Present</button>
  <button class="btn btn-sm btn-danger" onclick="markAbsent('${className}', ${i})" ${status ? 'disabled' : ''}>Absent</button>
</td>

  <td><button class="btn btn-sm btn-info" onclick="viewProfile('${className}', ${i})">View</button></td>
<td><button class="btn btn-sm btn-outline-danger" onclick="deleteStudent('${className}', ${i})">Delete</button></td>

    `;
    list.appendChild(row);
  });
}

function markPresent(className, index) {
 const today = getSelectedDate();
  const data = loadData();
  const student = data[className][index];

  if (!student.attendance[today]) {
    student.attendance[today] = "Present";
    saveData(data);
    showStudents();
  }
}


function markAbsent(className, index) {
const today = getSelectedDate();
  const data = loadData();
  const student = data[className][index];

  if (!student.attendance[today]) {
    student.attendance[today] = "Absent";
    saveData(data);
    showStudents();
  }
}


function deleteStudent(className, index) {
  if (confirm("Are you sure you want to delete this student?")) {
    const data = loadData();
    data[className].splice(index, 1); // Remove student
    saveData(data);
    showStudents(); // Refresh UI
  }
}




function viewProfile(className, index) {
  const data = loadData();
  const student = data[className][index];

  // Find all dates this class has attendance
  const allDates = new Set();
  data[className].forEach(std => {
    Object.keys(std.attendance).forEach(date => allDates.add(date));
  });

  let present = 0;
  let absent = 0;

  allDates.forEach(date => {
    if (student.attendance[date] === "Present") present++;
    else absent++;
  });

  const total = present + absent;
  const percent = total ? ((present / total) * 100).toFixed(2) : "0.00";

  alert(`Name: ${student.name}
Class: ${className}
Present: ${present}
Absent: ${absent}
Attendance: ${percent}%`);
}


function downloadPDF() {
  const data = loadData();
  const { jsPDF } = window.jspdf;
  const selectedDate = getSelectedDate();

  for (let className in data) {
    const doc = new jsPDF();
    let rows = [];

    data[className].forEach(student => {
      let status = student.attendance[selectedDate] || "Not Marked";
      rows.push([student.name, selectedDate, status]);
    });

    doc.text(`Attendance Report - ${className} - ${selectedDate}`, 14, 15);
    doc.autoTable({
      head: [["Student", "Date", "Status"]],
      body: rows,
      startY: 20,
      styles: { fontSize: 10 },
    });

    doc.save(`attendance_${className.replace(" ", "_")}_${selectedDate}.pdf`);
  }
}






function downloadCSV() {
  const data = loadData();
  let csv = "Class,Student,Date,Status\n";

  for (let className in data) {
    data[className].forEach(student => {
      for (let date in student.attendance) {
        csv += `${className},${student.name},${date},${student.attendance[date]}\n`;
      }
    });
  }

  const blob = new Blob([csv], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "attendance.csv";
  link.click();
}
</script>

  <script src="script.js"></script>
</body>
</html>
